---
import type { ImageMetadata } from "astro";
import { Image } from "astro:assets";
import BaseLayout from "@/layouts/BaseLayout.astro";
import Text from "@/components/fundations/typography/Text.astro";
import Wrapper from "@/components/fundations/containers/Wrapper.astro";
const { section, subsection } = Astro.params;
const components = await Astro.glob(`@/components/oxbow/**/*.astro`);
const sectionComponents = components.filter((component) => {
  const sectionRegex = new RegExp(`${section}\/${subsection}\/.+\.astro$`, "i");
  return component.file?.match(sectionRegex);
});
const images = import.meta.glob<{ default: ImageMetadata }>(
  "/src/screenshots/*.png"
);
const formattedSubsection = subsection.replace("-", " ");

const user = Astro.locals.user;
---

<BaseLayout>
  <section>
    <Wrapper variant="hero">
      <button
        class="flex items-center gap-2 text-base-500 hover:text-accent-500"
        onclick="history.back();"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="icon icon-tabler icons-tabler-outline icon-tabler-arrow-left size-5"
          ><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path
            d="M5 12l14 0"></path><path d="M5 12l6 6"></path><path
            d="M5 12l6 -6"></path></svg
        >Go Back</button
      >
      <Text
        tag="h1"
        variant="displayMD"
        class="uppercase mt-4 font-semibold tracking-tight text-black"
      >
        {subsection.replace(/-/g, " ")}
      </Text>
    </Wrapper>
    <Wrapper variant="standard" class="mt-12">
      <div
        class="relative w-full grid grid-cols-1 gap-2 md:grid-cols-2 lg:grid-cols-5"
      >
        {
          sectionComponents.map((component, index) => {
            const imagePath = `/src/screenshots/${component.file
              .split("/")
              .slice(-3)
              .join("_")
              .replace(".astro", ".png")}`;

            if (!images[imagePath]) {
              return null;
            }

            return (
              <Text
                tag="a"
                href={`/playground/${section}/${subsection}/${index + 1}`}
                class="relative group"
              >
                {!user && index === 0 && (
                  <div class="absolute top-2 left-2 p-1">
                    <span
                      class="flex items-center gap-1 text-white py-1 mt-1 px-2 border border-accent-800 rounded text-xs bg-accent-600"
                    >
                      Demo
                    </span>
                  </div>
                )}
                <div class="absolute top-2 right-2 p-1">
                  <div class="group-hover:flex items-center gap-1 bg-white py-1 mt-1 hidden px-2 border border-base-200 rounded text-xs">
                    <span class="text-black capitalize">
                      {subsection.replace(/-/g, " ")}
                      {index + 1}
                    </span>
                  </div>
                </div>

                <Image
                  src={images[imagePath]()}
                  alt={`${subsection} preview ${index + 1}`}
                  class="w-full object-cover mt-1 border border-base-200 cursor-pointer"
                />
              </Text>
            );
          })
        }
      </div>
    </Wrapper>
  </section>
</BaseLayout>
