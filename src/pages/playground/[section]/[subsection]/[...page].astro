---
import BaseLayout from "@/layouts/BaseLayout.astro";
import Playground from "@/components/global/Playground.astro";
import { paginate } from "@/utils/pagination";
const PAGE_SIZE = 10;
const { section, subsection, page } = Astro.params;
const components = await Astro.glob(`@/components/oxbow/**/*.astro`);
const sectionComponents = components.filter((component) => {
  const sectionRegex = new RegExp(`${section}\/${subsection}\/.+\.astro$`, "i");
  return component.file?.match(sectionRegex);
});
const currentPage = parseInt(page ?? "1", 10) || 1;
const paginationData = paginate(
  `/playground/${section}/${subsection}`,
  sectionComponents,
  currentPage,
  PAGE_SIZE
);
---

<BaseLayout>
  <section>
    <div class="max-w-5xl 2xl:max-w-[100rem] mx-auto px-8 pt-12 lg:pt-32">
      <div class="uppercase text-sm text-base-500 font-medium">
        <span>
          <a
            href="/"
            class="text-accent-500 hover:text-base-500 font-medium">
            Home</a
          > / Page {paginationData.currentPage}</span
        >
        /
        <span class="space-x-2">
          {
            paginationData.url.prev ? (
              <a
                class="text-accent-500 hover:text-base-500 font-medium"
                href={paginationData.url.prev}>
                Previous
              </a>
            ) : null
          }
          <span>Â·</span>
          {
            paginationData.url.next ? (
              <a
                class="text-accent-500 hover:text-base-500 font-medium"
                href={paginationData.url.next}>
                Next
              </a>
            ) : null
          }
        </span>
        <h1
          class="text-4xl mt-4 font-semibold tracking-tight text-black lg:text-balance 2xl:text-6xl">
          {subsection.replace(/-/g, " ")}
        </h1>
      </div>
    </div>
    <div class="maxc-w-screen 2xl:max-w-[100rem] mx-auto px-8">
      <div class="pb-32 mt-12 space-y-12">
        {
          paginationData.data.map((component, index) => (
            <Playground
              componentIndex={(currentPage - 1) * PAGE_SIZE + index + 1}
              componentPath={component.file.replace(/.*\/src/, "src")}
              playgroundRef={`${section}-${subsection}-${currentPage}-component-${index}`}>
              <component.default />
            </Playground>
          ))
        }
        <div class="flex items-center justify-between w-full">
          {
            paginationData.url.prev ? (
              <a
                class="items-center flex px-4 py-1 text-sm text-base-500 transition border rounded-full focus-visible:outline-none focus-visible:ring focus-visible:ring-base-200 hover:text-accent-500 ring-2 ring-offset-2 ring-transparent focus:ring-accent-500 duration-300"
                href={paginationData.url.prev}>
                Previous
              </a>
            ) : null
          }
          {
            paginationData.url.next ? (
              <a
                class="items-center flex px-4 py-1 ml-auto text-sm text-base-500 transition border rounded-full focus-visible:outline-none focus-visible:ring focus-visible:ring-base-200 hover:text-accent-500 ring-2 ring-offset-2 ring-transparent focus:ring-accent-500 duration-300"
                href={paginationData.url.next}>
                Next
              </a>
            ) : null
          }
        </div>
      </div>
    </div>
  </section>
  <script>
    function resizeIFramesToFitContent() {
      const iframes = document.querySelectorAll("iframe");
      iframes.forEach((iframe) => {
        try {
          iframe.height =
            iframe.contentWindow?.document.body.scrollHeight + "px";
        } catch (e) {}
      });
      requestAnimationFrame(resizeIFramesToFitContent);
    }
    addEventListener(
      "load",
      requestAnimationFrame.bind(this, resizeIFramesToFitContent)
    );
  </script>
</BaseLayout>
