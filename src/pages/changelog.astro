---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import Kicker from "@/components/fundations/typography/Kicker.astro";
import Text from "@/components/fundations/typography/Text.astro";
import Wrapper from "@/components/fundations/containers/Wrapper.astro";
// Load all changelog entries from content collection
const raw = await getCollection("changelog");
// Render MDX body for each entry
const entries = await Promise.all(
  raw.map(async (entry) => {
    const rendered = await entry.render();
    return { data: entry.data, Content: rendered.Content };
  })
);
// Sort latest first
entries.sort(
  (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);
// Assign IDs for anchor linking
const entriesWithIds = entries.map((entry) => ({
  ...entry,
  id: `entry-${entry.data.date}`,
}));
---

<BaseLayout>
  <Wrapper variant="standard" class="relative pt-12 pb-8 lg:pt-14">
    <h1 class="text-2xl font-semibold text-zinc-900">Changelog</h1>
    <div class="md:flex md:space-x-4 mt-12">
      <aside class="hidden md:block  lg:w-2/5 sticky top-20">
        <Text tag="h4" variant="textSM" class="font-semibold mb-2"
          >Contents</Text
        >
        <ul class="space-y-1">
          {
            entriesWithIds.map((entry) => (
              <li>
                <a
                  href={`#${entry.id}`}
                  class="text-zinc-700 hover:underline text-xs"
                >
                 
                  {entry.data.title}
                </a>
              </li>
            ))
          }
        </ul>
      </aside>
      <Wrapper variant="prose" class="max-w-xl mx-auto md:flex-1 lg:w-3/5">
        {
          entriesWithIds.map((entry) => (
            <section id={entry.id} class="mb-12">
              <Kicker>{entry.data.date}</Kicker>
              <Text tag="h3" variant="textBase" class="font-semibold mt-2">
                {entry.data.title}
              </Text>
              <div class="prose mt-2">
                <entry.Content />
              </div>
            </section>
          ))
        }
      </Wrapper>
    </div>
  </Wrapper>
</BaseLayout>
