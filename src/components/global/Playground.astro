---
import { Code } from "astro:components";
import * as prettier from "prettier";

const code = await Astro.slots.render("default");

const ppcode = await prettier
  .format(code, {
    parser: "lwc",
  })

interface Props {
  playgroundRef: string;
}

const { playgroundRef } = Astro.props;
const loggedIn = Boolean(Astro.locals.user);
---

<section x-data={`{ tab: 'preview' }`} class="not-prose">
  <div class="relative">
    <div class="pointer-events-none inset-x-0 top-0 z-10 md:left-auto">
      <div class="flex items-center justify-between py-2 backdrop-blur-sm">
        {loggedIn && (<div class="flex items-center ml-auto">
          <button
            @click="tab = 'preview'"
            :class="tab === 'preview' ? 'bg-black/5' : 'bg-black/0'"
            class="backdrop-blur pointer-events-auto mr-1 flex rounded-full px-4 py-1 text-sm text-black transition focus-visible:outline-none focus-visible:ring focus-visible:ring-black/50">
            Preview
          </button>
          <button
            @click="tab = 'code'"
            :class="tab === 'code' ? 'bg-black/5' : 'bg-black/0'"
            class="pointer-events-auto flex rounded-full px-4 py-1 text-sm text-black transition focus-visible:outline-none focus-visible:ring focus-visible:ring-black/50">
            Code
          </button>
          <div class="mx-1 h-4 w-[2px] bg-black/10"></div>
          <button
            x-data="{ copied: false }"
            class="pointer-events-auto relative flex rounded-md px-4 py-1 text-sm text-black transition focus-visible:outline-none focus-visible:ring focus-visible:ring-black/50"
            @click={
            `
              copied = true; 
              $clipboard(document.getElementById('${playgroundRef}').innerHTML);
              setTimeout(() => {
                copied = false;
              }, 2000);
            `
            }
          >
            <span
              x-text="copied ? 'Copied!' : 'Copy'"
              class="transition" 
            ></span>
          </button>
        </div>)}
      </div>
    </div>
    <div
      class="relative h-full w-full flex border overflow-hidden rounded-lg shadow-whiteOnWhite">
      <div
        id={`${playgroundRef}`}
        x-show="tab === 'preview'"
        class="flex-grow h-full">
        <Fragment set:html={code} />
      </div>
      {loggedIn && <div
        x-show="tab === 'code'"
        class="flex-grow h-full w-full text-xs overflow-auto p-4 ov bg-zinc-50 transition">
        <Code
          code={ppcode}
          lang="html"
          theme="css-variables"
        />
      </div>}
      <div
        class="absolute inset-y-0 my-auto h-full z-50 right-0 flex items-center">
        <div class="w-2 bg-blue h-8"></div>
      </div>
    </div>
  </div>
</section>

