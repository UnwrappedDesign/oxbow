---
import Logo from "@/components/assets/Logo.astro";

interface DocLink {
  slug: string;
  title: string;
  description?: string;
  category?: string;
  order?: number;
}

interface BlockLink {
  title: string;
  href: string;
}

interface BlockGroup {
  title: string;
  items: BlockLink[];
  order?: number;
}

interface Props {
  entries: DocLink[];
  activeSlug: string;
  blocks: BlockGroup[];
}

const { entries, activeSlug, blocks } = Astro.props as Props;

const componentGroups = Array.from(
  entries.reduce((map, entry) => {
    const key = entry.category || "Components";
    if (!map.has(key)) map.set(key, [] as DocLink[]);
    map.get(key)!.push(entry);
    return map;
  }, new Map<string, DocLink[]>())
).map(([groupTitle, items]) => ({
  title: groupTitle,
  items: items
    .slice()
    .sort(
      (a, b) =>
        (a.order ?? Number.MAX_SAFE_INTEGER) -
          (b.order ?? Number.MAX_SAFE_INTEGER) || a.title.localeCompare(b.title)
    ),
}));

const blockGroups = blocks
  .slice()
  .sort(
    (a, b) =>
      (a.order ?? Number.MAX_SAFE_INTEGER) -
        (b.order ?? Number.MAX_SAFE_INTEGER) || a.title.localeCompare(b.title)
  );
---

<aside
  class="fixed inset-y-0 left-0 z-50 w-72 -translate-x-full flex-col gap-6 overflow-y-auto border-r border-zinc-200 bg-white px-5 py-6 shadow-lg transition-transform duration-200 dark:border-zinc-800 dark:bg-zinc-900 lg:translate-x-0"
  data-docs-sidebar
>
  <header
    class="flex items-center justify-between border-b border-zinc-200 pb-4 dark:border-zinc-800"
  >
    <div
      class="flex items-center gap-3 text-sm font-semibold uppercase tracking-wide text-zinc-900 dark:text-zinc-50"
    >
      <Logo class="h-6 text-accent-600" />
      <span>Documentation</span>
    </div>
    <button
      type="button"
      class="inline-flex items-center rounded-md border border-zinc-200 bg-white px-2.5 py-1 text-xs font-medium text-zinc-600 transition hover:border-accent-300 hover:text-accent-600 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-200 lg:hidden"
      data-docs-close
    >
      Close
    </button>
  </header>

  <nav class="flex-1 space-y-5">
    {
      componentGroups.map((group) => (
        <details
          class="rounded-xl border border-zinc-200 bg-zinc-100/60 p-4 dark:border-zinc-700 dark:bg-zinc-800/60"
          open
        >
          <summary class="flex cursor-pointer items-center justify-between gap-2 text-xs font-semibold uppercase tracking-wide text-zinc-500 marker:content-[''] open:text-zinc-700 dark:text-zinc-400 dark:open:text-zinc-200">
            <span>{group.title}</span>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 20 20"
              fill="currentColor"
              class="size-3 text-zinc-400 transition-transform open:rotate-180 dark:text-zinc-300"
              aria-hidden="true"
            >
              <path
                fill-rule="evenodd"
                d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.27a.75.75 0 01.02-1.06z"
                clip-rule="evenodd"
              />
            </svg>
          </summary>
          <ul class="mt-4 space-y-1.5 text-sm">
            {group.items.map((item) => (
              <li>
                <a
                  href={`/documentation/${item.slug}`}
                  class:list={[
                    "flex items-center justify-between rounded-lg border px-3 py-2 transition",
                    item.slug === activeSlug
                      ? "border-accent-500 bg-accent-500/10 text-accent-700 dark:border-accent-400 dark:bg-accent-500/20 dark:text-accent-50"
                      : "border-transparent text-zinc-600 hover:border-accent-400 hover:bg-accent-500/10 hover:text-accent-600 dark:text-zinc-300 dark:hover:text-accent-200",
                  ]}
                >
                  <span>{item.title}</span>
                </a>
              </li>
            ))}
          </ul>
        </details>
      ))
    }

    {
      blockGroups.length > 0 && (
        <details
          class="rounded-xl border border-zinc-200 bg-zinc-100/60 p-4 dark:border-zinc-700 dark:bg-zinc-800/60"
          open
        >
          <summary class="flex cursor-pointer items-center justify-between gap-2 text-xs font-semibold uppercase tracking-wide text-zinc-500 marker:content-[''] open:text-zinc-700 dark:text-zinc-400 dark:open:text-zinc-200">
            <span>Blocks</span>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 20 20"
              fill="currentColor"
              class="size-3 text-zinc-400 transition-transform open:rotate-180 dark:text-zinc-300"
              aria-hidden="true"
            >
              <path
                fill-rule="evenodd"
                d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.27a.75.75 0 01.02-1.06z"
                clip-rule="evenodd"
              />
            </svg>
          </summary>
          <div class="mt-3 space-y-4">
            {blockGroups.map((group) => (
              <div>
                <p class="mb-2 text-xs font-semibold uppercase tracking-wide text-zinc-400 dark:text-zinc-500">
                  {group.title}
                </p>
                <ul class="space-y-1.5 text-sm">
                  {group.items.map((link) => (
                    <li>
                      <a
                        href={link.href}
                        class="flex items-center justify-between rounded-lg border border-transparent px-3 py-2 text-zinc-600 transition hover:border-accent-300 hover:bg-accent-500/10 hover:text-accent-600 dark:text-zinc-300 dark:hover:border-accent-300 dark:hover:text-accent-200"
                      >
                        <span>{link.title}</span>
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          viewBox="0 0 20 20"
                          fill="currentColor"
                          class="size-3"
                          aria-hidden="true"
                        >
                          <path
                            fill-rule="evenodd"
                            d="M12.293 2.293a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L13 4.414V17a1 1 0 11-2 0V4.414L9.707 7.707A1 1 0 018.293 6.293l4-4z"
                            clip-rule="evenodd"
                          />
                        </svg>
                      </a>
                    </li>
                  ))}
                </ul>
              </div>
            ))}
          </div>
        </details>
      )
    }
  </nav>
</aside>
