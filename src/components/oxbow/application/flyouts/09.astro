---
import Button from "@/components/fundations/buttons/Button.astro";
import Text from "@/components/fundations/typography/Text.astro";
import ChevronDown from "@/components/fundations/icons/ChevronDown.astro";
import FlyoutLinkBox from "@/components/fundations/wrappers/FlyoutLinkBox.astro";
import Refresh from "@/components/fundations/icons/Refresh.astro";
import FileDots from "@/components/fundations/icons/FileDots.astro";
import Edit from "@/components/fundations/icons/Edit.astro";
import Brain from "@/components/fundations/icons/Brain.astro";
import LoaderTwo from "@/components/fundations/icons/LoaderTwo.astro";
import Automation from "@/components/fundations/icons/Automation.astro";
import UsersGroup from "@/components/fundations/icons/UsersGroup.astro";
import Clock from "@/components/fundations/icons/Clock.astro";

const blogPosts = [
  {
    title: "Boost Your Workflow",
    subtitle:
      "Tips for optimizing productivity and efficiency in your daily tasks.",
    imageUrl:
      "https://images.unsplash.com/photo-1567679554719-721d7f6360c8?q=80&w=2475&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
  },
];
---

<div
  class="flex items-center justify-center w-full p-8 pb-145.5 mx-auto bg-white dark:bg-zinc-900"
>
  <!-- copy:start -->
  <div
    class="relative z-50 isolate"
    x-data="{
      uid: Math.random().toString(36).slice(2),
  // Set to true to show the flyout open by default. Change to false to have it closed by default.
  open: true,
      style: '',
      gap: 8,
      align() {
        const r = this.$refs.btn.getBoundingClientRect();
        const top = r.bottom + this.gap;     // full-width panel under the button
        this.style = `position:fixed; left:0; right:0; top:${top}px;`;
      },
      toggle() {
        if (this.open) { this.open = false; return; }
        window.dispatchEvent(new CustomEvent('close-all-flyouts', { detail: this.uid }));
        this.align();                        // set coords first
        requestAnimationFrame(() => this.open = true); // then show (no jitter)
      },
      close() { this.open = false; }
    }"
    x-init="
      window.addEventListener('close-all-flyouts', (e) => { if (e.detail !== uid) open = false });
      const realign = () => { if (open) align() };
      window.addEventListener('resize', realign);
      window.addEventListener('scroll', realign, { passive: true });
      // If open by default, align immediately
      if (open) align();
    "
  >
    <div
      class="flex items-center justify-center px-8 mx-auto max-w-7xl md:px-12 lg:px-24"
    >
      <Button
        x-ref="btn"
        aria-expanded="false"
        @click.stop="toggle"
        variant="muted"
        size="sm"
        gap="sm"
      >
        <span>Button</span>
        <ChevronDown size="sm" slot="right-icon" />
      </Button>
    </div>

    <!-- Backdrop for outside click -->
    <div
      x-show="open"
      x-transition.opacity
      class="fixed inset-0 z-[999]"
      @click="close"
      style="display:none"
    >
    </div>

    <!-- Teleported full-width flyout -->
    <template x-teleport="body">
      <div
        x-show="open"
        :style="style"
        class="z-[1000]"
        style="display:none"
        @keydown.escape.window="close"
        x-transition:enter="transition ease-out duration-200"
        x-transition:enter-start="opacity-0 -translate-y-1"
        x-transition:enter-end="opacity-100 translate-y-0"
        x-transition:leave="transition ease-in duration-150"
        x-transition:leave-start="opacity-100 translate-y-0"
        x-transition:leave-end="opacity-0 -translate-y-1"
      >
        <div class="px-8 md:px-12 lg:px-24">
          <div
            class="p-8 mx-auto bg-white dark:bg-zinc-800 shadow-lg max-w-7xl outline outline-zinc-900/5 dark:outline-white/10 rounded-xl"
          >
            <div
              class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-12"
            >
              <div>
                <Text
                  tag="h3"
                  variant="textBase"
                  class="font-medium text-zinc-900 dark:text-white"
                  >Benefits</Text
                >
                <div class="mt-2 flex flex-col gap-4">
                  <FlyoutLinkBox
                    href="#_"
                    icon={Refresh}
                    title="Sync across devices"
                    description="Enable syncing across devices"
                  />
                  <FlyoutLinkBox
                    href="#_"
                    icon={FileDots}
                    title="Create custom documents"
                    description="Stlye your documents with ease"
                  />
                  <FlyoutLinkBox
                    href="#_"
                    icon={Edit}
                    title=" Edit your files"
                    description="Endless possibilities"
                  />
                  <FlyoutLinkBox
                    href="#_"
                    icon={Brain}
                    title="Organize files"
                    description="Keep them all in one place"
                  />
                </div>
              </div>

              <div>
                <Text
                  tag="h3"
                  variant="textBase"
                  class="font-medium text-zinc-900 dark:text-white"
                  >Enhance Productivity</Text
                >
                <div class="mt-2 flex flex-col gap-4">
                  <FlyoutLinkBox
                    href="#_"
                    icon={LoaderTwo}
                    badge="New"
                    title="  Optimize Processes"
                    description="   Simplify tasks and save time"
                  />
                  <FlyoutLinkBox
                    href="#_"
                    icon={Automation}
                    title="Automate Efforts"
                    description=" Automate repetitive tasks"
                  />
                  <FlyoutLinkBox
                    href="#_"
                    icon={UsersGroup}
                    title="  Seamless Collaboration"
                    description=" Share and work together effortlessly"
                  />
                  <FlyoutLinkBox
                    href="#_"
                    icon={Clock}
                    title=" Track Time"
                    description="Monitor and manage time"
                  />
                </div>
              </div>

              <div>
                {
                  blogPosts.map((post) => (
                    <div class="relative flex flex-col gap-4 group">
                      <img
                        alt={post.title}
                        class="object-cover object-center aspect-[4/2] rounded-xl"
                        src={post.imageUrl}
                      />
                      <div>
                        <Text href="#_" tag="a" variant="textXL">
                          <span class="absolute inset-0 sm:rounded-2xl" />
                          <Text
                            tag="h3"
                            variant="textBase"
                            class="font-medium text-zinc-900 dark:text-white group-hover:text-zinc-500 dark:group-hover:text-zinc-400"
                          >
                            {post.title}
                          </Text>
                          <Text
                            tag="h3"
                            variant="textSM"
                            class="font-medium text-zinc-500 dark:text-zinc-400"
                          >
                            {post.subtitle}
                          </Text>
                        </Text>
                      </div>
                    </div>
                  ))
                }
              </div>
            </div>
          </div>
        </div>
      </div>
    </template>
  </div>
  <!-- copy:end -->
</div>
