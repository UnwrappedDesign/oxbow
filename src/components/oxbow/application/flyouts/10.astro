---
import Button from "@/components/fundations/buttons/Button.astro";
import Text from "@/components/fundations/typography/Text.astro";
import ChevronDown from "@/components/fundations/icons/ChevronDown.astro";

const links = [
  {
    category: "Browse by category",
    features: [
      { name: "New Arrivals", link: "#" },
      { name: "Best Sellers", link: "#" },
      { name: "Seasonal Favorites", link: "#" },
      { name: "Exclusive Collections", link: "#" },
      { name: "Trending Styles", link: "#" },
      { name: "Sale Items", link: "#" },
      { name: "Limited Edition", link: "#" },
    ],
  },
  {
    category: "Shop by feature",
    features: [
      { name: "Free Shipping", link: "#" },
      { name: "Sustainable Materials", link: "#" },
      { name: "Custom Sizing", link: "#" },
      { name: "Gift Cards", link: "#" },
      { name: "Style Guides", link: "#" },
      { name: "Personal Stylist", link: "#" },
      { name: "Loyalty Program", link: "#" },
    ],
  },
  {
    category: "Men's Collection",
    features: [
      { name: "Casual Wear", link: "#" },
      { name: "Formal Wear", link: "#" },
      { name: "Sportswear", link: "#" },
      { name: "Footwear", link: "#" },
      { name: "Accessories", link: "#" },
      { name: "Outerwear", link: "#" },
      { name: "Activewear", link: "#" },
    ],
  },
  {
    category: "Women's Collection",
    features: [
      { name: "Dresses", link: "#" },
      { name: "Tops & Blouses", link: "#" },
      { name: "Bottoms", link: "#" },
      { name: "Shoes", link: "#" },
      { name: "Jewelry & Accessories", link: "#" },
      { name: "Outerwear", link: "#" },
      { name: "Activewear", link: "#" },
    ],
  },
];
---

<div
  class="flex items-center justify-center w-full p-8 pb-145.5 mx-auto bg-white dark:bg-zinc-900"
>
  <!-- copy:start -->
  <div
    class="relative z-50 isolate"
    x-data="{
      uid: Math.random().toString(36).slice(2),
  // Set to true to show the flyout open by default. Change to false to have it closed by default.
  open: true,
      style: '',
      gap: 8,
      align() {
        const r = this.$refs.btn.getBoundingClientRect();
        const top = r.bottom + this.gap;              // full-width, just under button
        this.style = `position:fixed; left:0; right:0; top:${top}px;`;
      },
      toggle() {
        if (this.open) { this.open = false; return; }
        window.dispatchEvent(new CustomEvent('close-all-flyouts', { detail: this.uid }));
        this.align();                                  // compute coords first
        requestAnimationFrame(() => this.open = true); // then show (no jitter)
      },
      close() { this.open = false; }
    }"
    x-init="
      window.addEventListener('close-all-flyouts', (e) => { if (e.detail !== uid) open = false });
      const realign = () => { if (open) align() };
      window.addEventListener('resize', realign);
      window.addEventListener('scroll', realign, { passive: true });
      // If open by default, align immediately
      if (open) align();
    "
  >
    <div
      class="flex items-center justify-center px-8 mx-auto max-w-7xl md:px-12 lg:px-24"
    >
      <Button
        x-ref="btn"
        aria-expanded="false"
        @click.stop="toggle"
        variant="muted"
        size="sm"
        gap="sm"
      >
        <span>Button</span>
        <ChevronDown size="sm" slot="right-icon" />
      </Button>
    </div>

    <!-- Backdrop (outside click) -->
    <div
      x-show="open"
      x-transition.opacity
      class="fixed inset-0 z-[999]"
      @click="close"
      style="display:none"
    >
    </div>

    <!-- Teleported full-width flyout -->
    <template x-teleport="body">
      <div
        x-show="open"
        :style="style"
        class="z-[1000] bg-white dark:bg-zinc-900 shadow-lg ring-1 ring-zinc-900/5 dark:ring-zinc-700"
        style="display:none"
        @keydown.escape.window="close"
        x-transition:enter="transition ease-out duration-200"
        x-transition:enter-start="opacity-0 -translate-y-1"
        x-transition:enter-end="opacity-100 translate-y-0"
        x-transition:leave="transition ease-in duration-150"
        x-transition:leave-start="opacity-100 translate-y-0"
        x-transition:leave-end="opacity-0 -translate-y-1"
      >
        <div class="px-8 py-8 mx-auto max-w-7xl md:px-12 lg:px-24">
          <div
            class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-x-8 gap-y-12"
          >
            {
              links.map((categoryItem) => (
                <div>
                  <Text
                    tag="h3"
                    variant="textBase"
                    class="font-medium text-zinc-900 dark:text-zinc-100"
                  >
                    {categoryItem.category}
                  </Text>
                  <div
                    class="pt-4 mt-4 border-t border-zinc-200 dark:border-zinc-700 space-y-2"
                    role="none"
                  >
                    {categoryItem.features.map((feature) => (
                      <Text
                        tag="a"
                        href={feature.link}
                        variant="textBase"
                        class="block font-medium hover:text-blue-500 dark:hover:text-blue-400 text-zinc-500 dark:text-zinc-400 "
                      >
                        {feature.name}
                      </Text>
                    ))}
                  </div>
                </div>
              ))
            }
          </div>

          <div
            class="items-end p-8 mt-12 grid grid-cols-1 gap-4 sm:grid-cols-2 bg-zinc-50 dark:bg-zinc-800 rounded-2xl"
          >
            <div>
              <Text
                tag="h3"
                variant="textLG"
                class="font-medium text-zinc-900 dark:text-zinc-100"
              >
                Discover your perfect style
              </Text>
              <Text
                tag="p"
                variant="textBase"
                class="mt-4 font-medium text-zinc-500 dark:text-zinc-400 lg:text-balance"
              >
                Explore the latest trends and effortlessly shop exclusive
                collections, all while enjoying a personalized shopping
                experience tailored just for you
              </Text>
            </div>
            <div
              class="flex flex-col items-center gap-2 lg:flex-row sm:ml-auto"
            >
              <Button variant="accent" size="sm">Get started</Button>
              <Button variant="alternative" size="sm">Learn more</Button>
            </div>
          </div>
        </div>
      </div>
    </template>
  </div>
  <!-- copy:end -->
</div>
