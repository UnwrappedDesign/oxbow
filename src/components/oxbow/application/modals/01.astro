---
export const description = "Invite team members to your account";

// Transition utility classes toggled by Alpine. Keep them stable in prod.
export const excludeFromObfuscation = [
  "opacity-0",
  "opacity-100",
  "translate-y-4",
  "sm:translate-y-0",
  "sm:scale-95",
];
import UsersGroup from "@/components/fundations/icons/UsersGroup.astro";
import Check from "@/components/fundations/icons/Check.astro";
import X from "@/components/fundations/icons/X.astro";
import Button from "@/components/fundations/buttons/Button.astro";
import Text from "@/components/fundations/typography/Text.astro";
import IconButton from "@/components/fundations/buttons/IconButton.astro";
---

<div
  class="p-8 pt-12 pb-120 bg-white dark:bg-zinc-900 flex items-center justify-center"
>
  <!-- Copy:start -->
  <!--
// Make sure to change  "open: false",  to  open: true. On the z-data="{}".
//
//Programmatic usage:
//
// window.dispatchEvent(new CustomEvent('open-invite-modal')) // or call $refs.show() inside Alpine
-->
  <div
    class="w-full max-w-xl mx-auto"
    x-data="{
      open: true,
      sent: false,
      form: { email:'', role:'viewer' },
      reset(){ this.form = { email:'', role:'viewer' }; this.sent = false; },
      show(){ this.reset(); this.open = true; this.$nextTick(()=> this.$refs.email?.focus()); },
      close(){ this.open = false; },
      submit(){
        if(!this.form.email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.form.email)) return;
        this.sent = true;
        setTimeout(()=> this.close(), 1400);
      }
    }"
  >
    <Button
      variant="default"
      size="sm"
      type="button"
      class="mx-auto"
      @click="show()"
    >
      Invite teammate
    </Button>
    <!-- Backdrop -->
    <div
      x-show="open"
      x-transition.opacity
      class="fixed inset-0 z-40 bg-black/40 dark:bg-white/20"
      @click="close()"
      aria-hidden="true"
    >
    </div>
    <!-- Dialog -->
    <div
      x-show="open"
      x-transition:enter="transition ease-out duration-200"
      x-transition:enter-start="opacity-0"
      x-transition:enter-end="opacity-100"
      x-transition:leave="transition ease-in duration-150"
      x-transition:leave-start="opacity-100"
      x-transition:leave-end="opacity-0"
      class="fixed inset-0 z-50 flex items-end sm:items-center justify-center p-4"
      role="dialog"
      aria-modal="true"
      aria-labelledby="invite-title"
      @keydown.escape.window.prevent="close()"
    >
      <div
        x-show="open"
        x-transition:enter="transition ease-out duration-200"
        x-transition:enter-start="translate-y-4 sm:translate-y-0 sm:scale-95"
        x-transition:enter-end="translate-y-0 sm:scale-100"
        x-transition:leave="transition ease-in duration-150"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        @click.outside="close()"
        class="w-full sm:max-w-lg rounded-xl bg-white dark:bg-zinc-800 shadow-lg outline outline-1 outline-black/5 dark:-outline-offset-1 dark:outline-white/10 p-4 sm:p-6"
      >
        <!-- Header -->
        <div class="flex items-start gap-3">
          <div
            class="shrink-0 size-10 rounded-full grid place-items-center bg-zinc-100 dark:bg-zinc-700 text-zinc-700 dark:text-zinc-200"
          >
            <UsersGroup size="sm" />
          </div>
          <div class="flex-1 min-w-0">
            <Text
              tag="h2"
              variant="textSM"
              id="invite-title"
              class="font-semibold text-zinc-900 dark:text-zinc-100"
            >
              Invite teammate
            </Text>
            <Text
              variant="textXS"
              tag="p"
              class="text-xs text-zinc-600 dark:text-zinc-300"
            >
              Send an invite by email and choose a role.
            </Text>
          </div>

          <IconButton
            variant="text"
            size="xxs"
            aria-label="Close"
            @click="close()"><X size="sm" /></IconButton
          >
        </div>
        <!-- Body: form / success -->
        <div class="mt-4" x-show="!sent">
          <label
            class="block text-xs font-medium text-zinc-700 dark:text-zinc-200"
            >Email</label
          >
          <input
            x-ref="email"
            x-model="form.email"
            type="email"
            placeholder="name@company.com"
            class="mt-1 block w-full h-10 px-4 py-2 text-xs bg-white border border-transparent rounded-lg appearance-none dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300 duration-300 ring-1 ring-zinc-200 dark:ring-zinc-700 placeholder-zinc-400 dark:placeholder-zinc-500 focus:border-zinc-300 dark:focus:border-blue-700 focus:bg-transparent focus:outline-none focus:ring-blue-500 focus:ring-offset-2 focus:ring-2 sm:text-sm"
          />
          <label
            class="block mt-3 text-xs font-medium text-zinc-700 dark:text-zinc-200"
            >Role</label
          >
          <div class="mt-1 flex gap-2">
            <button
              type="button"
              @click="form.role='viewer'"
              :class="form.role==='viewer' ? 'bg-zinc-900 dark:bg-white text-white dark:text-zinc-900' : 'outline outline outline-zinc-200 text-zinc-700 dark:outline-zinc-700 dark:text-zinc-200'"
              class="h-8 px-2 rounded-md text-xs font-medium">Viewer</button
            >
            <button
              type="button"
              @click="form.role='editor'"
              :class="form.role==='editor' ? 'bg-zinc-900 dark:bg-white text-white dark:text-zinc-900' : 'outline outline outline-zinc-200 text-zinc-700 dark:outline-zinc-700 dark:text-zinc-200'"
              class="h-8 px-2 rounded-md text-xs font-medium">Editor</button
            >
            <button
              type="button"
              @click="form.role='admin'"
              :class="form.role==='admin' ? 'bg-zinc-900 dark:bg-white text-white dark:text-zinc-900' : 'outline outline outline-zinc-200 text-zinc-700 dark:outline-zinc-700 dark:text-zinc-200'"
              class="h-8 px-2 rounded-md text-xs font-medium">Admin</button
            >
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 mt-3">
            <div>
              <label
                class="block text-xs font-medium text-zinc-700 dark:text-zinc-200"
                >Department</label
              >
              <select
                class="mt-1 block w-full h-10 px-4 py-2 text-xs bg-white border border-transparent rounded-lg appearance-none dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300 duration-300 ring-1 ring-zinc-200 dark:ring-zinc-700 placeholder-zinc-400 dark:placeholder-zinc-500 focus:border-zinc-300 dark:focus:border-blue-700 focus:bg-transparent focus:outline-none focus:ring-blue-500 focus:ring-offset-2 focus:ring-2 sm:text-sm"
              >
                <option>General</option>
                <option>Engineering</option>
                <option>Design</option>
                <option>Marketing</option>
              </select>
            </div>
            <div>
              <label
                class="block text-xs font-medium text-zinc-700 dark:text-zinc-200"
                >Expires</label
              >
              <select
                class="mt-1 block w-full h-10 px-4 py-2 text-xs bg-white border border-transparent rounded-lg appearance-none dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300 duration-300 ring-1 ring-zinc-200 dark:ring-zinc-700 placeholder-zinc-400 dark:placeholder-zinc-500 focus:border-zinc-300 dark:focus:border-blue-700 focus:bg-transparent focus:outline-none focus:ring-blue-500 focus:ring-offset-2 focus:ring-2 sm:text-sm"
              >
                <option>7 days</option>
                <option>30 days</option>
                <option>Never</option>
              </select>
            </div>
          </div>
        </div>
        <div class="mt-4 flex items-center gap-2" x-show="!sent">
          <Button
            size="xs"
            variant="outline"
            type="button"
            :disabled="!form.email"
            @click="submit()">Send invite</Button
          >
          <Button
            size="xs"
            variant="outline"
            type="button"
            @click="navigator.clipboard.writeText(window.location.origin + '/invite?role=' + form.role)"
            >Copy invite link</Button
          >
          <Button variant="danger" size="xs" type="button" @click="close()"
            >Cancel</Button
          >
        </div>
        <!-- Success state -->
        <div class="mt-2" x-show="sent" x-transition.opacity>
          <div
            class="flex items-center gap-2 text-green-700 dark:text-green-400"
          >
            <Check size="sm" />
            <p class="text-sm">
              Invitation sent to <span class="font-medium" x-text="form.email"
              ></span>.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Copy:end -->
</div>
