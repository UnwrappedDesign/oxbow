---
export const excludeFromObfuscation = [
  "opacity-0",
  "opacity-100",
  "translate-y-4",
  "sm:translate-y-0",
  "sm:scale-95",
];
import LibraryPhoto from "@/components/fundations/icons/LibraryPhoto.astro";
import MapPin from "@/components/fundations/icons/MapPin.astro";
import CircleInfo from "@/components/fundations/icons/CircleInfo.astro";
import X from "@/components/fundations/icons/X.astro";
import Button from "@/components/fundations/buttons/Button.astro";
import Text from "@/components/fundations/typography/Text.astro";
import IconButton from "@/components/fundations/buttons/IconButton.astro";
---

<div
  class="p-8 pb-250 pt-20 bg-white dark:bg-zinc-900 flex items-center justify-center"
>
  <!-- Copy:start -->
  <!--
// Make sure to change  "open: false",  to  open: true. On the z-data="{}".
-->
  <div
    class="w-full max-w-3xl"
    x-data="{
      open:true,
      drag:false,
      submitting:false,
      form:{
        name:'',
        website:'',
        logo:'',
        slug:'',
        industry:'SaaS',
        size:'1–10',
        hq:'',
        tags:[],
        tagInput:'',
        description:'',
      },
      show(){ this.reset(); this.open = true; this.$nextTick(()=> this.$refs.name?.focus()); },
      reset(){ this.form={ name:'', website:'', logo:'', slug:'', industry:'SaaS', size:'1–10', hq:'', tags:[], tagInput:'', description:'' }; this.drag=false; this.submitting=false; },
      close(){ if(this.submitting) return; this.open=false; },
      urlOk(v){ try { const u=new URL(v.startsWith('http')?v:`https://${v}`); return !!u.host; } catch { return false; } },
      slugOk(v){ return /^[a-z0-9]([a-z0-9-]{1,28})[a-z0-9]$/.test(v||''); },
      valid(){ return this.form.name && this.urlOk(this.form.website) && this.slugOk(this.form.slug) && this.form.description.trim().length>0; },
      addTag(){ const v=(this.form.tagInput||'').trim().toLowerCase(); if(!v) return; if(this.form.tags.length>=10) return; if(!this.form.tags.includes(v)) this.form.tags.push(v); this.form.tagInput=''; },
      rmTag(i){ this.form.tags.splice(i,1); },
      pick(e){ const f=e.target?.files?.[0]; if(f) this.readLogo(f); },
      drop(e){ e.preventDefault(); const f=e.dataTransfer?.files?.[0]; if(f) this.readLogo(f); this.drag=false; },
      readLogo(file){ try{ this.form.logo=URL.createObjectURL(file);}catch{} },
      submit(){ if(!this.valid()) return; this.submitting=true; setTimeout(()=>{ window.dispatchEvent(new CustomEvent('org:create',{ detail:{ ...this.form } })); this.submitting=false; this.open=false; },700); }
    }"
  >
    <Button
      variant="default"
      size="sm"
      type="button"
      class="mx-auto"
      @click="show()">Add organization</Button
    >
    <!-- Backdrop -->
    <div
      x-show="open"
      x-transition.opacity
      class="fixed inset-0 z-40 bg-black/40 dark:bg-white/20"
      aria-hidden="true"
      @click="close()"
    >
    </div>
    <!-- Dialog -->
    <div
      x-show="open"
      x-transition:enter="transition ease-out duration-200"
      x-transition:enter-start="opacity-0"
      x-transition:enter-end="opacity-100"
      x-transition:leave="transition ease-in duration-150"
      x-transition:leave-start="opacity-100"
      x-transition:leave-end="opacity-0"
      class="fixed inset-0 z-50 flex items-end sm:items-center justify-center p-4"
      role="dialog"
      aria-modal="true"
      aria-labelledby="org-title"
      @keydown.escape.window.prevent="close()"
    >
      <div
        x-show="open"
        @click.outside="close()"
        x-transition:enter="transition ease-out duration-200"
        x-transition:enter-start="translate-y-4 sm:translate-y-0 sm:scale-95"
        x-transition:enter-end="translate-y-0 sm:scale-100"
        x-transition:leave="transition ease-in duration-150"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        class="w-full sm:max-w-3xl rounded-2xl bg-white dark:bg-zinc-800 shadow-xl outline outline-1 outline-black/5 dark:-outline-offset-1 dark:outline-white/10"
      >
        <!-- Header -->
        <div
          class="flex items-center justify-between px-6 py-4 border-b border-zinc-100 dark:border-zinc-700"
        >
          <div class="flex items-start gap-2">
            <div
              class="size-9 rounded-lg grid place-items-center bg-zinc-100 dark:bg-zinc-700 text-zinc-700 dark:text-zinc-200"
            >
              <CircleInfo size="sm" />
            </div>
            <div>
              <Text
                tag="h2"
                variant="textSM"
                id="org-title"
                class="font-semibold text-zinc-900 dark:text-white"
              >
                Create an organization
              </Text>
              <Text
                tag="p"
                variant="textXS"
                class="text-zinc-600 dark:text-zinc-300"
              >
                Set a name, logo, and public profile. Takes under 5 minutes.
              </Text>
            </div>
          </div>
          <IconButton
            variant="text"
            size="xxs"
            aria-label="Close"
            @click="close()"><X size="sm" /></IconButton
          >
        </div>
        <!-- Content -->
        <div class="px-6 py-5 space-y-5">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Company name -->
            <div>
              <label
                class="block text-xs font-medium text-zinc-700 dark:text-zinc-200"
                >Organization name*</label
              >
              <input
                x-ref="name"
                x-model="form.name"
                type="text"
                placeholder="e.g. Northwind"
                class="mt-1 block w-full h-10 px-4 py-2 text-xs bg-white border border-transparent rounded-lg appearance-none dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300 duration-300 ring-1 ring-zinc-200 dark:ring-zinc-700 placeholder-zinc-400 dark:placeholder-zinc-500 focus:border-zinc-300 dark:focus:border-blue-700 focus:bg-transparent focus:outline-none focus:ring-blue-500 focus:ring-offset-2 focus:ring-2 sm:text-sm"
              />
            </div>
            <!-- Website -->
            <div>
              <label
                class="block text-xs font-medium text-zinc-700 dark:text-zinc-200"
                >Website URL*</label
              >
              <input
                x-model="form.website"
                type="text"
                placeholder="www.example.com"
                class="mt-1 block w-full h-10 px-4 py-2 text-xs bg-white border border-transparent rounded-lg appearance-none dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300 duration-300 ring-1 ring-zinc-200 dark:ring-zinc-700 placeholder-zinc-400 dark:placeholder-zinc-500 focus:border-zinc-300 dark:focus:border-blue-700 focus:bg-transparent focus:outline-none focus:ring-blue-500 focus:ring-offset-2 focus:ring-2 sm:text-sm"
              />
            </div>
            <!-- Logo dropzone spans two cols -->
            <div class="md:col-span-2">
              <label class="sr-only">Logo*</label>
              <div class="mt-1 grid grid-cols-[96px_1fr] gap-3 items-start">
                <div
                  class="size-24 rounded-xl overflow-hidden ring-1 ring-zinc-200 dark:ring-zinc-700 bg-zinc-100 dark:bg-zinc-700 grid place-items-center"
                >
                  <img
                    x-show="form.logo"
                    :src="form.logo"
                    alt="Logo"
                    class="size-full object-cover"
                  />
                  <div x-show="!form.logo" class="text-zinc-400">
                    <LibraryPhoto size="base" />
                  </div>
                </div>
                <div>
                  <label class="sr-only">Profile image</label>
                  <div
                    @dragover.prevent
                    @dragenter.prevent="drag=true"
                    @dragleave.prevent="drag=false"
                    @drop="drop($event)"
                    :class="drag ? 'ring-2 ring-indigo-500 bg-indigo-50/40 dark:bg-indigo-400/10' : 'ring-1 ring-zinc-200 dark:ring-zinc-700'"
                    class="rounded-xl p-4 bg-white dark:bg-zinc-800 text-center"
                  >
                    <LibraryPhoto
                      size="sm"
                      class="text-zinc-500 dark:text-zinc-30 mx-auto mb-1"
                    />
                    <label
                      class="text-xs
                      text-blue-600
                      dark:text-blue-400
                      cursor-pointer font-medium"
                    >
                      <input
                        type="file"
                        class="sr-only"
                        accept="image/*"
                        @change="pick($event)"
                      />Click to upload
                    </label>
                    <span class="text-xs text-zinc-500 font-medium">
                      or drag & drop</span
                    >
                    <div class="mt-1 text-[0.70rem] text-zinc-500 font-medium">
                      SVG, PNG, JPG, GIF (max 800×400px)
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- Slug -->
            <div>
              <label
                class="block text-xs font-medium text-zinc-700 dark:text-zinc-200"
                >Public URL*</label
              >
              <div
                class="mt-1 grid grid-cols-[minmax(120px,180px)_1fr] items-center"
              >
                <div
                  class="block w-full h-10 px-4 py-2 text-xs bg-white border border-transparent rounded-lg rounded-r-none appearance-none bg-zinc-50 dark:bg-white/5 text-zinc-700 dark:text-zinc-300 duration-300 ring-1 ring-zinc-200 dark:ring-zinc-700 placeholder-zinc-400 dark:placeholder-zinc-500 focus:border-zinc-300 dark:focus:border-blue-700 focus:bg-transparent focus:outline-none focus:ring-blue-500 focus:ring-offset-2 focus:ring-2 sm:text-sm"
                >
                  example.com/org/
                </div>
                <input
                  x-model="form.slug"
                  type="text"
                  placeholder="acme"
                  class="block w-full h-10 px-4 py-2 text-xs bg-white border border-transparent rounded-lg rounded-l-none appearance-none dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300 duration-300 ring-1 ring-zinc-200 dark:ring-zinc-700 placeholder-zinc-400 dark:placeholder-zinc-500 focus:border-zinc-300 dark:focus:border-blue-700 focus:bg-transparent focus:outline-none focus:ring-blue-500 focus:ring-offset-2 focus:ring-2 sm:text-sm"
                />
              </div>
              <p
                class="mt-1 text-[0.70rem]"
                :class="slugOk(form.slug)?'text-green-600 dark:text-green-400':'text-red-600 dark:text-red-400'"
                x-text="slugOk(form.slug) ? 'Looks good' : 'Use 3–30 lowercase letters or dashes' "
              >
              </p>
            </div>
            <!-- Industry -->
            <div>
              <label
                class="block text-xs font-medium text-zinc-700 dark:text-zinc-200"
                >Industry</label
              >
              <select
                x-model="form.industry"
                class="mt-1 block w-full h-10 px-4 py-2 text-xs bg-white border border-transparent rounded-lg appearance-none dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300 duration-300 ring-1 ring-zinc-200 dark:ring-zinc-700 placeholder-zinc-400 dark:placeholder-zinc-500 focus:border-zinc-300 dark:focus:border-blue-700 focus:bg-transparent focus:outline-none focus:ring-blue-500 focus:ring-offset-2 focus:ring-2 sm:text-sm"
              >
                <option>SaaS</option>
                <option>E‑commerce</option>
                <option>Marketplace</option>
                <option>Agency/Services</option>
                <option>Open Source</option>
              </select>
            </div>
            <!-- Size -->
            <div>
              <label
                class="block text-xs font-medium text-zinc-700 dark:text-zinc-200"
                >Team size</label
              >
              <select
                x-model="form.size"
                class="mt-1 block w-full h-10 px-4 py-2 text-xs bg-white border border-transparent rounded-lg appearance-none dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300 duration-300 ring-1 ring-zinc-200 dark:ring-zinc-700 placeholder-zinc-400 dark:placeholder-zinc-500 focus:border-zinc-300 dark:focus:border-blue-700 focus:bg-transparent focus:outline-none focus:ring-blue-500 focus:ring-offset-2 focus:ring-2 sm:text-sm"
              >
                <option>1–10</option>
                <option>11–50</option>
                <option>51–200</option>
                <option>200+</option>
              </select>
            </div>
            <!-- HQ -->
            <div class="md:col-span-2">
              <label
                class="block text-xs font-medium text-zinc-700 dark:text-zinc-200"
                >Headquarters</label
              >
              <div class="mt-1 flex items-center gap-2">
                <div class="text-zinc-500 dark:text-zinc-300">
                  <MapPin size="sm" />
                </div>
                <input
                  x-model="form.hq"
                  type="text"
                  placeholder="City, Country"
                  class="flex-1 mt-1 block w-full h-10 px-4 py-2 text-xs bg-white border border-transparent rounded-lg appearance-none dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300 duration-300 ring-1 ring-zinc-200 dark:ring-zinc-700 placeholder-zinc-400 dark:placeholder-zinc-500 focus:border-zinc-300 dark:focus:border-blue-700 focus:bg-transparent focus:outline-none focus:ring-blue-500 focus:ring-offset-2 focus:ring-2 sm:text-sm"
                />
              </div>
            </div>
            <!-- Tags -->
            <div class="md:col-span-2">
              <label
                class="block text-xs font-medium text-zinc-700 dark:text-zinc-200"
                >Keywords (1–10)</label
              >
              <div class="mt-1 flex items-end gap-2">
                <input
                  x-model="form.tagInput"
                  @keydown.enter.prevent="addTag()"
                  type="text"
                  placeholder="e.g. b2b, saas, marketplace"
                  class="flex-1 mt-1 block w-full h-10 px-4 py-2 text-xs bg-white border border-transparent rounded-lg appearance-none dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300 duration-300 ring-1 ring-zinc-200 dark:ring-zinc-700 placeholder-zinc-400 dark:placeholder-zinc-500 focus:border-zinc-300 dark:focus:border-blue-700 focus:bg-transparent focus:outline-none focus:ring-blue-500 focus:ring-offset-2 focus:ring-2 sm:text-sm"
                />
                <Button
                  variant="outline"
                  size="base"
                  type="button"
                  :disabled="!form.tagInput"
                  @click="addTag()">Add</Button
                >
              </div>
              <div class="mt-2 flex flex-wrap gap-2">
                <template x-for="(t,i) in form.tags" :key="t">
                  <span
                    class="inline-flex items-center gap-1 text-xs px-2 py-1 rounded-full bg-zinc-100 dark:bg-zinc-700 text-zinc-700 dark:text-zinc-200"
                  >
                    <span x-text="t"></span>
                    <button
                      type="button"
                      class="text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300"
                      @click="rmTag(i)">×</button
                    >
                  </span>
                </template>
              </div>
            </div>
            <!-- Description -->
            <div class="md:col-span-2">
              <label
                class="block text-xs font-medium text-zinc-700 dark:text-zinc-200"
                >About the organization*</label
              >
              <textarea
                x-model="form.description"
                rows="4"
                placeholder="What do you build? Who do you help?"
                class="mt-1 block w-full px-4 py-2 text-xs bg-white border border-transparent rounded-lg appearance-none dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300 duration-300 ring-1 ring-zinc-200 dark:ring-zinc-700 placeholder-zinc-400 dark:placeholder-zinc-500 focus:border-zinc-300 dark:focus:border-blue-700 focus:bg-transparent focus:outline-none focus:ring-blue-500 focus:ring-offset-2 focus:ring-2 sm:text-sm"
              ></textarea>
            </div>
          </div>
        </div>
        <!-- Footer -->
        <div
          class="px-6 py-4 border-t border-zinc-100 dark:border-zinc-700 flex items-center gap-3"
        >
          <label
            class="inline-flex items-center gap-2 text-sm text-zinc-500 dark:text-zinc-400 text-xs"
          >
            <input
              type="checkbox"
              class="rounded border-zinc-300 dark:border-zinc-600 dark:bg-zinc-800 text-blue-600 focus:ring-blue-500 focus:ring-offset-2 focus:ring-2 shadow size-4"
              x-model="form.dontShow"
            />
            Don’t show again
          </label>
          <div class="ml-auto flex items-center gap-2">
            <Button
              variant="outline"
              size="xxs"
              type="button"
              @click="close()"
              :disabled="submitting">Cancel</Button
            >
            <Button
              variant="accent"
              size="xxs"
              type="button"
              @click="submit()"
              :disabled="!valid() || submitting">Create organization</Button
            >
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Copy:end -->
</div>
