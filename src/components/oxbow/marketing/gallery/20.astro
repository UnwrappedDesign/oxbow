---
import Text from "@/components/fundations/typography/Text.astro";
import IconButton from "@/components/fundations/buttons/IconButton.astro";
import ChevronDown from "@/components/fundations/icons/ChevronDown.astro";
import ChevronUp from "@/components/fundations/icons/ChevronUp.astro";
import X from "@/components/fundations/icons/X.astro";
import g1 from "@/images/gallery/1.png";
import g2 from "@/images/gallery/2.png";
import g3 from "@/images/gallery/3.png";
import g4 from "@/images/gallery/4.png";
import g5 from "@/images/gallery/5.png";
import g6 from "@/images/gallery/6.png";
import g7 from "@/images/gallery/7.png";
import g8 from "@/images/gallery/8.png";
const gallery = [
  { src: g1.src, alt: "Oxbow UI" },
  { src: g2.src, alt: "Oxbow UI" },
  { src: g3.src, alt: "Oxbow UI" },
  { src: g4.src, alt: "Oxbow UI" },
  { src: g5.src, alt: "Oxbow UI" },
  { src: g6.src, alt: "Oxbow UI" },
  { src: g7.src, alt: "Oxbow UI" },
  { src: g8.src, alt: "Oxbow UI" },
];
---

<!---
// Set  `isOpen` to `false` to hide the lightbox. 
// isOpen: true,
-->
<section
  class="bg-white dark:bg-zinc-900"
  x-data={`{
    gallery: ${JSON.stringify(gallery)},
    currentIndex: 0,
    isOpen: true,
    openLightbox(index) { this.currentIndex = index; this.isOpen = true; },
    closeLightbox() { this.isOpen = false; },
    next() { this.currentIndex = (this.currentIndex + 1) % this.gallery.length; },
    prev() { this.currentIndex = (this.currentIndex - 1 + this.gallery.length) % this.gallery.length; }
  }`}
>
  <div class="px-8 py-24 mx-auto max-w-7xl md:px-12 lg:px-32">
    <Text
      variant="textSM"
      tag="p"
      class="pb-12 mt-4 italic text-center text-zinc-500 dark:text-zinc-400"
    >
      Click on the image to open it in a lightbox.
    </Text>
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 lg:grid-cols-4">
      {
        gallery.map(({ src, alt }, index) => (
          <img
            src={src}
            alt={alt}
            class="object-cover cursor-pointer size-full aspect-square hover:opacity-80 transition-opacity"
            @click={`openLightbox(${index})`}
          />
        ))
      }
    </div>
  </div>
  <!-- Lightbox -->
  <div
    x-show="isOpen"
    x-init="$el.focus()"
    role="dialog"
    aria-modal="true"
    aria-label="Image gallery"
    tabindex="0"
    @keydown.escape="closeLightbox"
    @keydown.arrow-left="prev"
    @keydown.arrow-right="next"
    class="fixed inset-0 bg-white/80 dark:bg-zinc-900/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 supports-[backdrop-filter]:dark:bg-zinc-900/60 flex items-start justify-center z-50 overflow-auto p-8 md:p-12 lg:p-32 outline-none"
  >
    <div class="relative w-full max-w-3xl mx-auto" @click.stop>
      <!-- Hidden heading for screen readers -->
      <h2 class="sr-only">Image Gallery Carousel</h2>
      <!-- Carousel Wrapper (responsive height) -->
      <div class="overflow-hidden h-[50vh] sm:h-[60vh] md:h-[80vh]">
        <div
          class="flex flex-col h-full transition-transform duration-500"
          x-bind:style="`transform: translateY(-${currentIndex * 100}%)`"
        >
          <template x-for="(item, idx) in gallery" :key="idx">
            <div class="flex items-center justify-center flex-shrink-0 h-full">
              <img
                :src="item.src"
                :alt="item.alt"
                class="object-cover object-top w-auto lg:h-120 aspect-square"
              />
            </div>
          </template>
        </div>
      </div>
      <!-- Navigation Arrows -->
      <div class="absolute z-20 left-2 top-1/2 transform -translate-y-1/2">
        <div class="flex flex-col gap-2">
          <IconButton
            variant="default"
            size="sm"
            aria-label="Next image"
            @click.stop="next"
          >
            <ChevronUp slot="icon" size="xl" />
          </IconButton>
          <IconButton
            variant="default"
            size="sm"
            aria-label="Previous image"
            @click.stop="prev"
          >
            <ChevronDown slot="icon" size="xl" /></IconButton
          >
        </div>
      </div>
      <!-- Dot Indicators -->
      <div class="absolute z-20 right-2 top-1/2 transform -translate-y-1/2">
        <div class="flex flex-col justify-center mt-4 gap-2">
          <template x-for="(_, idx) in gallery" :key="idx">
            <button
              @click="currentIndex = idx"
              class="w-2 h-2 rounded-full"
              :class="idx === currentIndex ? 'bg-white' : 'bg-white/50 hover:bg-white'"
              :aria-label="`Go to image ${idx + 1}`"></button>
          </template>
        </div>
      </div>
      <!-- Close Button -->
      <button
        class="absolute z-50 top-2 right-2"
        aria-label="Close gallery"
        @click.stop="closeLightbox"
      >
        <X
          slot="icon"
          size="sm"
          class="text-black dark:text-white hover:text-zinc-300"
        />
      </button>
    </div>
  </div>
</section>
